{% extends "base.html" %}
{% block content %}
<a href="/" style="color:var(--text-dim); text-decoration:none; font-size:0.7rem;">[ ← VOLVER ]</a>

<div style="display: grid; grid-template-columns: 1fr 350px; gap: 20px; margin-top:20px;">
    <div class="form-box">
        <h1 style="margin:0;">{{ e.nombre }}</h1>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <div>
                <label style="color:var(--orange); font-size:0.7rem;">MARCA</label><p>{{ e.marca }}</p>
                <label style="color:var(--orange); font-size:0.7rem;">CATEGORÍA</label><p>{{ e.categoria }}</p>
            </div>
            <div>
                <label style="color:var(--orange); font-size:0.7rem;">STOCK</label><p>{{ e.cantidad_en_uso }} / {{ e.cantidad_total }} en uso</p>
            </div>
        </div>

        <form action="/equipo/{{ e.id }}/update" method="POST" enctype="multipart/form-data" style="margin-top: 30px;">
            <label style="color:var(--orange); font-size:0.7rem;">OBSERVACIONES</label><br>
            <textarea name="observaciones" rows="6" style="width:100%; margin-top:10px; color:#00ff88; font-family:'JetBrains Mono';">{{ e.observaciones }}</textarea>
            <div style="margin-top:20px; display:flex; justify-content:space-between;">
                <input type="file" name="manual" style="font-size:0.7rem;">
                <button type="submit" class="btn-main">GUARDAR CAMBIOS</button>
            </div>
        </form>
    </div>

    <div>
        <div class="form-box" style="margin-bottom:20px;">
            <h4 style="margin:0 0 10px 0; color:var(--orange);">DOCUMENTO</h4>
            {% if e.manual_filename %}
                <a href="{{ url_for('download_manual', filename=e.manual_filename) }}" style="color:#00ff88; font-weight:bold; text-decoration:none;">⬇ DESCARGAR MANUAL</a>
            {% else %}
                <p style="color:var(--text-dim); font-size:0.7rem;">No hay archivos.</p>
            {% endif %}
        </div>
        <div class="form-box">
            <h4 style="margin:0 0 10px 0; color:var(--orange);">HISTORIAL RECIENTE</h4>
            <div style="font-size:0.7rem;">
                {% for h in e.movimientos|reverse %}
                    {% if loop.index <= 5 %}
                    <div style="border-bottom:1px solid #222; padding:5px 0;">
                        {{ h.fecha.strftime('%d/%m/%y') }} - <b>{{ h.tipo }}</b> (x{{ h.cantidad }})
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}